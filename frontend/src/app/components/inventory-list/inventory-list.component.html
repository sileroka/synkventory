<div class="card">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <div class="flex justify-content-between align-items-center mb-4">
    <h1>Inventory Management</h1>
    <p-button label="Add Item" icon="pi pi-plus" (onClick)="showAddDialog()"></p-button>
  </div>

  <p-table
    [value]="items"
    [loading]="loading"
    [paginator]="true"
    [rows]="pageSize"
    [totalRecords]="totalRecords"
    [lazy]="true"
    (onLazyLoad)="onPageChange($event)"
    [rowsPerPageOptions]="[10, 25, 50]"
    [tableStyle]="{'min-width': '60rem'}"
    styleClass="p-datatable-striped">

    <ng-template pTemplate="header">
      <tr>
        <th>SKU</th>
        <th>Name</th>
        <th>Description</th>
        <th>Quantity</th>
        <th>Reorder Point</th>
        <th>Status</th>
        <th>Unit Price</th>
        <th>Category</th>
        <th>Location</th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-item>
      <tr>
        <td>{{ item.sku }}</td>
        <td>{{ item.name }}</td>
        <td>{{ item.description }}</td>
        <td>{{ item.quantity }}</td>
        <td>{{ item.reorderPoint }}</td>
        <td>
          <span class="status-badge" [ngClass]="'status-' + item.status">
            {{ getStatusLabel(item.status) }}
          </span>
        </td>
        <td>{{ item.unitPrice | currency }}</td>
        <td>{{ item.category?.name || '-' }}</td>
        <td>{{ item.location?.name || '-' }}</td>
        <td>
          <p-button
            icon="pi pi-pencil"
            [rounded]="true"
            [text]="true"
            severity="info"
            (onClick)="showEditDialog(item)">
          </p-button>
          <p-button
            icon="pi pi-trash"
            [rounded]="true"
            [text]="true"
            severity="danger"
            (onClick)="deleteItem(item)">
          </p-button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="10" class="text-center">No items found. Click "Add Item" to create one.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog
  [(visible)]="displayDialog"
  [header]="isEditMode ? 'Edit Item' : 'Add Item'"
  [modal]="true"
  [style]="{width: '450px'}"
  [draggable]="false"
  [resizable]="false">

  <div class="flex flex-column gap-3">
    <div>
      <label for="name" class="block mb-2">Name *</label>
      <input pInputText id="name" [(ngModel)]="selectedItem.name" class="w-full" required />
    </div>

    <div>
      <label for="sku" class="block mb-2">SKU *</label>
      <input pInputText id="sku" [(ngModel)]="selectedItem.sku" class="w-full" required />
    </div>

    <div>
      <label for="description" class="block mb-2">Description</label>
      <textarea pInputTextarea id="description" [(ngModel)]="selectedItem.description"
        class="w-full" rows="3"></textarea>
    </div>

    <div>
      <label for="quantity" class="block mb-2">Quantity *</label>
      <p-inputNumber id="quantity" [(ngModel)]="selectedItem.quantity"
        class="w-full" [min]="0"></p-inputNumber>
    </div>

    <div>
      <label for="reorderPoint" class="block mb-2">Reorder Point</label>
      <p-inputNumber id="reorderPoint" [(ngModel)]="selectedItem.reorderPoint"
        class="w-full" [min]="0"></p-inputNumber>
    </div>

    <div>
      <label for="status" class="block mb-2">Status</label>
      <p-select id="status" [(ngModel)]="selectedItem.status"
        [options]="statusOptions" optionLabel="label" optionValue="value"
        class="w-full" styleClass="w-full"></p-select>
    </div>

    <div>
      <label for="unitPrice" class="block mb-2">Unit Price *</label>
      <p-inputNumber id="unitPrice" [(ngModel)]="selectedItem.unitPrice"
        class="w-full" mode="currency" currency="USD" [min]="0"></p-inputNumber>
    </div>

    <div>
      <label for="category" class="block mb-2">Category</label>
      <p-select id="category" [(ngModel)]="selectedItem.categoryId"
        [options]="categoryOptions" optionLabel="label" optionValue="value"
        placeholder="Select a category"
        class="w-full" styleClass="w-full"></p-select>
    </div>

    <div>
      <label for="location" class="block mb-2">Location</label>
      <p-select id="location" [(ngModel)]="selectedItem.locationId"
        [options]="locationOptions" optionLabel="label" optionValue="value"
        placeholder="Select a location"
        class="w-full" styleClass="w-full"></p-select>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <p-button label="Cancel" icon="pi pi-times" (onClick)="displayDialog = false"
      severity="secondary"></p-button>
    <p-button label="Save" icon="pi pi-check" (onClick)="saveItem()"></p-button>
  </ng-template>
</p-dialog>
