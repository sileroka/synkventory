<div class="forecast-page">
  <p-card header="Forecast Demand" [style]="{ 'margin-bottom': '1rem' }">
    <div class="controls">
      <div class="row">
        <label>Item</label>
        <p-autoComplete
          [(ngModel)]="selectedItem"
          [suggestions]="itemResults"
          (completeMethod)="searchItems($event)"
          field="name"
          placeholder="Search items..."
          [style]="{ width: '320px' }"
        >
          <ng-template let-item pTemplate="item">
            <span>{{ item.sku }} - {{ item.name }}</span>
          </ng-template>
        </p-autoComplete>
      </div>

      <div class="row">
        <label>Method</label>
        <p-dropdown
          [options]="methodOptions"
          [(ngModel)]="method"
          [style]="{ width: '220px' }"
        ></p-dropdown>
      </div>

      <div class="row">
        <label>Window Size</label>
        <p-inputNumber
          [(ngModel)]="windowSize"
          [min]="1"
          [max]="90"
        ></p-inputNumber>
        <label style="margin-left: 1rem">Periods</label>
        <p-inputNumber
          [(ngModel)]="periods"
          [min]="1"
          [max]="365"
        ></p-inputNumber>
        <label style="margin-left: 1rem" *ngIf="method === 'exp_smoothing'"
          >Alpha</label
        >
        <p-inputNumber
          *ngIf="method === 'exp_smoothing'"
          [(ngModel)]="alpha"
          [min]="0.01"
          [max]="1"
          [step]="0.05"
        ></p-inputNumber>
        <button
          pButton
          type="button"
          label="Run Forecast"
          class="p-button-sm"
          (click)="runForecast()"
        ></button>
      </div>
      <div class="row" style="margin-left: auto">
        <label>View</label>
        <button
          pButton
          type="button"
          [outlined]="viewMode() !== 'chart'"
          label="Chart"
          class="p-button-sm"
          (click)="setView('chart')"
        ></button>
        <button
          pButton
          type="button"
          [outlined]="viewMode() !== 'table'"
          label="Table"
          class="p-button-sm"
          (click)="setView('table')"
        ></button>
      </div>
    </div>

    <div class="results" *ngIf="forecasts() as data">
      <p-chart
        *ngIf="viewMode() === 'chart'"
        type="line"
        [data]="chartData()"
        [options]="chartOptions()"
        style="display: block; max-width: 100%"
      ></p-chart>
      <p-table
        *ngIf="viewMode() === 'table'"
        [value]="data"
        [paginator]="true"
        [rows]="25"
        [rowHover]="true"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Date</th>
            <th>Quantity</th>
            <th>Method</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-f>
          <tr>
            <td>{{ f.forecastDate | date : "yyyy-MM-dd" }}</td>
            <td
              [pTooltip]="
                'Forecast quantity for ' +
                (f.forecastDate | date : 'yyyy-MM-dd')
              "
            >
              {{ f.quantity | number : "1.0-0" }}
            </td>
            <td
              [pTooltip]="
                f.method === 'moving_average'
                  ? 'Moving Average'
                  : 'Exponential Smoothing'
              "
            >
              {{ f.method }}
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <div class="loading" *ngIf="loading()">
      <p-progressSpinner></p-progressSpinner>
    </div>
  </p-card>

  <p-card header="Reorder Suggestions">
    <app-reorder-suggestions></app-reorder-suggestions>
  </p-card>
</div>
